<title>Elematter</title> <style>*,:after,:before{-moz-box-sizing:border-box;box-sizing:border-box;-webkit-transition-duration:500ms;transition-duration:500ms;-webkit-transition-property:none;transition-property:none}body,html{height:100%}body{background:#181818;background:radial-gradient(ellipse at center,#282828 0,#060606 100%);font-family:sans-serif;overflow:hidden;-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.g{box-shadow:0 0 0 20px rgba(0,0,0,.5);left:50%;opacity:0;position:absolute;-webkit-transition:opacity 500ms;transition:opacity 500ms;top:50%}.g.loaded{opacity:1}.s{bottom:0;left:0;position:absolute;right:0;top:0}.tile{background:hsla(0,0%,100%,.05);left:0;position:absolute;top:0;-webkit-transition-property:background;transition-property:background}.tile:hover{background:#666;background:hsla(0,0%,100%,.2);-webkit-transition-duration:0ms;transition-duration:0ms}.tile.path{background:#111;box-shadow:0 -6px 0 #000}.tile.path:hover{background:#311;cursor:not-allowed}.row{background:#000;height:40px;left:0;position:absolute;width:100%;z-index:100}.top-row{top:0}.bot-row{bottom:0;padding-top:1px}.b{background:#333;box-shadow:inset 0 0 0 1px hsla(0,0%,100%,.15);color:hsla(0,0%,100%,.6);cursor:pointer;display:block;float:left;font-size:13px;height:39px;line-height:37px;margin:0 1px 0 0;position:relative;text-align:center;text-shadow:0 1px 1px #000;-webkit-transition-property:background,box-shadow,color,opacity;transition-property:background,box-shadow,color,opacity}.b:before{background:-moz-linear-gradient(top,transparent 0,hsla(0,0%,100%,.075) 100%);background:linear-gradient(to bottom,transparent 0,hsla(0,0%,100%,.075) 100%);content:'';height:50%;left:0;position:absolute;top:0;width:100%}.b:hover{background:#444;color:#fff;-webkit-transition-duration:0ms;transition-duration:0ms}.s1{width:39px}.s2{width:79px}.s3{width:119px}.s3:last-child{width:120px;margin-right:0}.s4{width:159px}.s4:last-child{width:160px;margin-right:0}.b i{display:inline-block;font-size:16px;font-style:normal;margin-right:3px}.playing .b-play{background:#222;box-shadow:inset 0 0 0 1px #333,inset 0 0 10px hsla(0,0%,0%,.75);color:#fff}.playing .b-play:hover{background:#333}.x1 .b-x1,.x1 .b-x1:hover,.x2 .b-x2,.x2 .b-x2:hover,.x3 .b-x3,.x3 .b-x3:hover{background:#222;box-shadow:inset 0 0 0 1px #333,inset 0 0 10px hsla(0,0%,0%,.75);color:#fff;cursor:default}.b-e{background:#234223;color:#51e051}.b-e:hover{background:#2d6b2d;color:#9ef99e}.b-w{background:#233842;color:#51b0e0}.b-w:hover{background:#2d566b;color:#9edbf9}.b-a{background:#424223;color:#e0e051}.b-a:hover{background:#6b6b2d;color:#f9f99e}.b-f{background:#422323;color:#e05151}.b-f:hover{background:#6b2d2d;color:#f99e9e}.muted .b-mute{background:#222;box-shadow:inset 0 0 0 1px #333,inset 0 0 10px hsla(0,0%,0%,.75);color:#fff}.muted .b-mute:hover{background:#333}.b-send{opacity:.25}.b-send:hover{background:#333;color:hsla(0,0%,100%,.6);cursor:not-allowed;opacity:.25}.playing .b-send{opacity:1}.playing .b-send:hover{background:#444;color:#fff;cursor:pointer}.d,.l{background:#090909;box-shadow:inset 0 0 0 1px hsla(0,0%,100%,.05);color:hsla(0,0%,100%,.6);display:block;float:left;font-size:13px;height:39px;line-height:37px;margin:0 1px 0 0;position:relative;text-align:center;text-shadow:0 1px 1px #000;-webkit-transition-property:background,box-shadow,color;transition-property:background,box-shadow,color}.d:before,.l:before{background:-moz-linear-gradient(top,transparent 0,hsla(0,0%,100%,.075) 100%);background:linear-gradient(to bottom,transparent 0,hsla(0,0%,100%,.075) 100%);content:'';height:50%;left:0;position:absolute;top:0;width:100%}.d i,.l i{font-size:16px;font-style:normal}.l{background:#111}.w{margin:0 2px}.w-e{color:#3df43d}.w-w{color:#3db7f4}.w-a{color:#f4f43d}.w-f{color:#f43d3d}.build-menu-wrap{background:hsla(0,0%,20%,.4);bottom:0;left:0;opacity:0;position:absolute;right:0;top:0;-webkit-transition:visibility 150ms 150ms,opacity 150ms;transition:visibility 150ms 150ms,opacity 150ms;visibility:hidden;z-index:200}.build-menu-open .build-menu-wrap{opacity:1;-webkit-transition-delay:0ms;transition-delay:0ms;visibility:visible}.build-menu{cursor:default;left:0;position:absolute;top:0;width:280px}.build-selects{background:hsla(0,0%,0%,.75);height:80px;position:relative;width:100%}.build-selects:before{background:-moz-linear-gradient(top,transparent 0,hsla(0,0%,100%,.1) 100%);background:linear-gradient(to bottom,transparent 0,hsla(0,0%,100%,.1) 100%);content:'';height:50%;left:0;pointer-events:none;position:absolute;top:0;width:100%;z-index:2}.build-select{background:#fff;box-shadow:inset 0 0 0 20px hsla(0,0%,100%,0);cursor:pointer;height:40px;position:absolute;top:20px;-webkit-transition:background 300ms,box-shadow 300ms;transition:background 300ms,box-shadow 300ms;width:40px}.build-d.anim{background:hsla(0,0%,100%,.15);border:2px dashed #fff;cursor:default;-webkit-animation:build-d 500ms ease-in-out infinite alternate;animation:build-d 500ms ease-in-out infinite alternate}@-webkit-keyframes build-d{to{box-shadow:inset 0 0 0 0 transparent;opacity:0}}@keyframes build-d{to{box-shadow:inset 0 0 0 0 transparent;opacity:0}}.build-d{background:#fff}.build-e{background:#3df43d}.build-w{background:#3db7f4}.build-a{background:#f4f43d}.build-f{background:#f43d3d}.build-a:hover,.build-e:hover,.build-f:hover,.build-w:hover{box-shadow:inset 0 0 0 2px hsla(0,0%,100%,.35)}.build-e:hover{background:#0f890f}.build-w:hover{background:#0f6089}.build-a:hover{background:#89890f}.build-f:hover{background:#890f0f}.pos-w .build-d{left:20px}.pos-w .build-e{left:70px}.pos-w .build-w{left:120px}.pos-w .build-a{left:170px}.pos-e .build-d,.pos-w .build-f{left:220px}.pos-e .build-e{left:20px}.pos-e .build-w{left:70px}.pos-e .build-a{left:120px}.pos-e .build-f{left:170px}.build-info{background:hsla(0,0%,0%,.75);font-size:13px;height:145px;left:0;line-height:1.7;opacity:0;padding:0 20px;position:absolute;-webkit-transition:opacity 300ms 300ms;transition:opacity 300ms 300ms;width:100%}.hover-build-select .build-info{opacity:1;-webkit-transition-delay:0ms;transition-delay:0ms}.pos-n .build-info{padding-bottom:15px;top:80px}.pos-s .build-info{bottom:80px;padding-top:15px}.build-title{border-bottom:1px solid #333;font-size:16px;font-weight:700;margin-bottom:7px;padding-bottom:7px}.build-title i{color:#fff;font-style:normal;margin-right:14px}.hover-e .build-type{color:#3df43d}.hover-w .build-type{color:#3db7f4}.hover-a .build-type{color:#f4f43d}.hover-f .build-type{color:#f43d3d}.build-cost{color:#fff}.build-desc{color:#fff;font-style:italic}.build-stat{color:#aaa}.build-stat strong{display:inline-block;margin-right:3px;text-align:right;width:58px}.build-meter{display:inline-block;margin-right:3px;vertical-align:top}.build-meter span{background:#444;display:inline-block;height:12px;margin-right:1px;position:relative;top:6px;vertical-align:top;width:8px}.hover-e .build-meter span{background:#3df43d}.hover-w .build-meter span{background:#3db7f4}.hover-a .build-meter span{background:#f4f43d}.hover-f .build-meter span{background:#f43d3d}.dmg1 .build-dmg-wrap .build-meter span:nth-child(2),.dmg1 .build-dmg-wrap .build-meter span:nth-child(3),.dmg2 .build-dmg-wrap .build-meter span:nth-child(3),.rng1 .build-rng-wrap .build-meter span:nth-child(2),.rng1 .build-rng-wrap .build-meter span:nth-child(3),.rng2 .build-rng-wrap .build-meter span:nth-child(3),.rte1 .build-rte-wrap .build-meter span:nth-child(2),.rte1 .build-rte-wrap .build-meter span:nth-child(3),.rte2 .build-rte-wrap .build-meter span:nth-child(3){background:#444}.t-wrap,.t-wrap div{position:absolute}.t-base,.t-core,.t-slab,.t-tower{bottom:0;left:0;right:0;top:0}.t-wrap{height:40px;-webkit-transition:background 300ms;transition:background 300ms;width:40px;z-index:100}.t-wrap:hover{-webkit-transition-duration:0ms;transition-duration:0ms;z-index:101}.t-wrap.t-type-e:hover{background:hsla(120,50%,50%,.2)}.t-wrap.t-type-w:hover{background:hsla(200,50%,50%,.2)}.t-wrap.t-type-a:hover{background:hsla(60,50%,50%,.2)}.t-wrap.t-type-f:hover{background:hsla(0,50%,50%,.2)}.t-tower{cursor:pointer;height:28px;margin:auto;width:28px}.t-range{border:2px solid transparent;border-radius:100%;content:'';height:200px;left:50%;margin:-100px 0 0 -100px;opacity:0;pointer-events:none;top:50%;-webkit-transform:scale(0.75);transform:scale(0.75);-webkit-transition:all 300ms ease-in-out;transition:all 300ms ease-in-out;width:200px;z-index:1}.t-type-e .t-range{background:hsla(120,100%,90%,.1);border-color:hsla(120,100%,70%,.3)}.t-type-w .t-range{background:hsla(200,100%,90%,.1);border-color:hsla(200,100%,70%,.3)}.t-type-a .t-range{background:hsla(60,100%,90%,.1);border-color:hsla(60,100%,70%,.3)}.t-type-f .t-range{background:hsla(0,100%,90%,.1);border-color:hsla(0,100%,70%,.3)}.t-wrap:hover .t-range{opacity:1;-webkit-transition-duration:0ms;transition-duration:0ms;-webkit-transform:scale(1);transform:scale(1)}.t-slab{background:#121;border:1px solid transparent}.t-type-e .t-slab{background:#0c260c;border-color:#1e7a1e}.t-type-w .t-slab{background:#0c1d26;border-color:#1e5b7a}.t-type-a .t-slab{background:#26260c;border-color:#7a7a1e}.t-type-f .t-slab{background:#260c0c;border-color:#7a1e1e}.t-base{border:4px solid #111;border-radius:50%}.t-type-e .t-base{background:#2d6b2d;box-shadow:0 0 0 1px #2d6b2d}.t-type-w .t-base{background:#2d566b;box-shadow:0 0 0 1px #2d566b}.t-type-a .t-base{background:#6b6b2d;box-shadow:0 0 0 1px #6b6b2d}.t-type-f .t-base{background:#6b2d2d;box-shadow:0 0 0 1px #6b2d2d}.t-turret{background:#6c6;height:50%;left:0;top:0;transform-origin:100% 100%;width:50%}.t-type-e .t-turret{background:#7ce87c}.t-type-w .t-turret{background:#7cc4e8}.t-type-a .t-turret{background:#e8e87c}.t-type-f .t-turret{background:#e87c7c}.t-core{border-radius:50%;margin:auto}.t-type-e .t-core{background:#65ff65}.t-type-w .t-core{background:#65cbff}.t-type-a .t-core{background:#feff65}.t-type-f .t-core{background:#ff6565}.enemy{left:0;position:absolute;top:0;z-index:100}.enemy.type-e{background:#3df43d}.enemy.type-w{background:#3db7f4}.enemy.type-a{background:#f4f43d}.enemy.type-f{background:#f43d3d}</style>  <div class="g x1">  <div class="s s-play">  <div class="row top-row"> <a class="b b-play s3"><i>&rtrif;</i>Play</a> <a class="b b-x1 s1">&times;1</a> <a class="b b-x2 s1">&times;2</a> <a class="b b-x3 s1">&times;3</a> <a class="b b-e s2 atk" title="Destroy all Earth enemies"><i>&otimes;</i>Earth</a> <a class="b b-w s2 atk" title="Destroy all Water enemies"><i>&otimes;</i>Water</a> <a class="b b-a s2 atk" title="Destroy all Air enemies"><i>&otimes;</i>Air</a> <a class="b b-f s2 atk" title="Destroy all Fire enemies"><i>&otimes;</i>Fire</a> <a class="b b-mute s3"><i>&sung;</i>Mute</a> <a class="b b-menu s3"><i>&equiv;</i>Menu</a> </div>  <div class="row bot-row"> <div class="l s1"><i>&hearts;</i></div> <div class="d d-lives s2">13 / 13</div> <div class="l s1"><i>&there4;</i></div> <div class="d d-fragments s2"> </div> <div class="l s2">Wave</div> <div class="d d-wave s2"> </div> <div class="l s2">Next</div> <div class="d d-next s4"> &times;<span class="w w-e">10</span> &times;<span class="w w-w">10</span> &times;<span class="w w-a">10</span> &times;<span class="w w-f">10</span> </div> <a class="b b-send s4"><i>&raquo;</i>Send Next +300 <i>&there4;</i></a> </div>  <div class=build-menu-wrap> <div class=build-menu> <div class=build-selects> <a class="build-select build-d"></a> <a class="build-select build-e" data-type=e></a> <a class="build-select build-w" data-type=w></a> <a class="build-select build-a" data-type=a></a> <a class="build-select build-f" data-type=f></a> </div> <div class=build-info> <div class=build-title> <span class=build-cost> </span> <i>&there4;</i> <span class=build-type> </span> </div> <div class=build-desc> </div> <div class="build-stat build-dmg-wrap"> <strong>Damage:</strong> <span class=build-meter><span></span><span></span><span></span></span> <span class=build-damage> </span> </div> <div class="build-stat build-rng-wrap"> <strong>Range:</strong> <span class=build-meter><span></span><span></span><span></span></span> <span class=build-range> </span> </div> <div class="build-stat build-rte-wrap"> <strong>Rate:</strong> <span class=build-meter><span></span><span></span><span></span></span> <span class=build-rate> </span> </div> </div> </div> </div> </div> </div> <script>function SfxrParams(){this.setSettings=function(t){for(var e=0;24>e;e++)this[String.fromCharCode(97+e)]=t[e]||0;this.c<.01&&(this.c=.01);var i=this.b+this.c+this.e;if(.18>i){var s=.18/i;this.b*=s,this.c*=s,this.e*=s}}}function SfxrSynth(){this._params=new SfxrParams;var t,e,i,s,o,a,n,h,r,g,l,c;this.reset=function(){var t=this._params;s=100/(t.f*t.f+.001),o=100/(t.g*t.g+.001),a=1-t.h*t.h*t.h*.01,n=-t.i*t.i*t.i*1e-6,t.a||(l=.5-t.n/2,c=5e-5*-t.o),h=1+t.l*t.l*(t.l>0?-.9:10),r=0,g=1==t.m?0:(1-t.m)*(1-t.m)*2e4+32},this.totalReset=function(){this.reset();var s=this._params;return t=s.b*s.b*1e5,e=s.c*s.c*1e5,i=s.e*s.e*1e5+12,3*((t+e+i)/3|0)},this.synthWave=function(d,u){var p=this._params,m=1!=p.s||p.v,f=p.v*p.v*.1,y=1+3e-4*p.w,v=p.s*p.s*p.s*.1,w=1+1e-4*p.t,S=1!=p.s,b=p.x*p.x,x=p.g,k=p.q||p.r,C=p.r*p.r*p.r*.2,M=p.q*p.q*(p.q<0?-1020:1020),P=p.p?((1-p.p)*(1-p.p)*2e4|0)+32:0,W=p.d,T=p.j/2,q=p.k*p.k*.01,A=p.a,E=t,B=1/t,z=1/e,R=1/i,G=5/(1+p.u*p.u*20)*(.01+v);G>.8&&(G=.8),G=1-G;for(var O,D,L,j,_,F,I=!1,X=0,H=0,N=0,U=0,J=0,V=0,Y=0,K=0,Q=0,Z=0,$=new Array(1024),te=new Array(32),ee=$.length;ee--;)$[ee]=0;for(var ee=te.length;ee--;)te[ee]=2*Math.random()-1;for(var ee=0;u>ee;ee++){if(I)return ee;if(P&&++Q>=P&&(Q=0,this.reset()),g&&++r>=g&&(g=0,s*=h),a+=n,s*=a,s>o&&(s=o,x>0&&(I=!0)),D=s,T>0&&(Z+=q,D*=1+Math.sin(Z)*T),D|=0,8>D&&(D=8),A||(l+=c,0>l?l=0:l>.5&&(l=.5)),++H>E)switch(H=0,++X){case 1:E=e;break;case 2:E=i}switch(X){case 0:N=H*B;break;case 1:N=1+2*(1-H*z)*W;break;case 2:N=1-H*R;break;case 3:N=0,I=!0}k&&(M+=C,L=0|M,0>L?L=-L:L>1023&&(L=1023)),m&&y&&(f*=y,1e-5>f?f=1e-5:f>.1&&(f=.1)),F=0;for(var ie=8;ie--;){if(Y++,Y>=D&&(Y%=D,3==A))for(var se=te.length;se--;)te[se]=2*Math.random()-1;switch(A){case 0:_=l>Y/D?.5:-.5;break;case 1:_=1-Y/D*2;break;case 2:j=Y/D,j=6.28318531*(j>.5?j-1:j),_=1.27323954*j+.405284735*j*j*(0>j?1:-1),_=.225*((0>_?-1:1)*_*_-_)+_;break;case 3:_=te[Math.abs(32*Y/D|0)]}m&&(O=V,v*=w,0>v?v=0:v>.1&&(v=.1),S?(J+=(_-V)*v,J*=G):(V=_,J=0),V+=J,U+=V-O,U*=1-f,_=U),k&&($[K%1024]=_,_+=$[(K-L+1024)%1024],K++),F+=_}F*=.125*N*b,d[ee]=F>=1?32767:-1>=F?-32768:32767*F|0}return u}}var synth=new SfxrSynth;window.jsfxr=function(t){synth._params.setSettings(t);var e=synth.totalReset(),i=new Uint8Array(4*((e+1)/2|0)+44),s=2*synth.synthWave(new Uint16Array(i.buffer,44),e),o=new Uint32Array(i.buffer,0,44);o[0]=1179011410,o[1]=s+36,o[2]=1163280727,o[3]=544501094,o[4]=16,o[5]=65537,o[6]=44100,o[7]=88200,o[8]=1048578,o[9]=1635017060,o[10]=s,s+=44;for(var a=0,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",h="data:audio/wav;base64,";s>a;a+=3){var r=i[a]<<16|i[a+1]<<8|i[a+2];h+=n[r>>18]+n[r>>12&63]+n[r>>6&63]+n[63&r]}return h},g={},g.data={},g.Group=function(){this.collection=[],this.length=0},g.Group.prototype.push=function(t){return this.length++,this.collection.push(t)},g.Group.prototype.pop=function(){return this.length--,this.collection.pop()},g.Group.prototype.unshift=function(t){return this.length++,this.collection.unshift(t)},g.Group.prototype.shift=function(){return this.length--,this.collection.shift()},g.Group.prototype.getAt=function(t){return this.collection[t]},g.Group.prototype.removeAt=function(t){t<this.length&&(this.collection.splice(t,1),this.length--)},g.Group.prototype.remove=function(t){var e=this.collection.indexOf(t);e>-1&&(this.collection.splice(e,1),this.length--)},g.Group.prototype.empty=function(){this.collection.length=0,this.length=0},g.Group.prototype.each=function(t,e,i){var s,o=this.length,a=g.isString(t),n=i||window;if(e)for(s=0;o>s;s++)a?this.collection[s][t](s):t.bind(n,this.collection[s],s,this.collection)();else for(s=o;s--;)a?this.collection[s][t](s):t.bind(n,this.collection[s],s,this.collection)()},g.Pool=function(t,e){this.base=t,this.preallocateAmount=e||0,this.alive=[],this.dead=[],this.length=0,this.deadLength=0,this.preallocateAmount&&this.preallocate()},g.Pool.prototype.preallocate=function(){for(var t=0;t<this.preallocateAmount;t++)this.dead.push(new this.base),this.deadLength++},g.Pool.prototype.create=function(t){if(this.deadLength){var e=this.dead.pop();e.init(t),this.alive.push(e),this.deadLength--,this.length++}else this.alive.push(new this.base(t)),this.length++},g.Pool.prototype.release=function(t){var e=this.alive.indexOf(t);e>-1&&(this.dead.push(this.alive.splice(e,1)[0]),this.length--,this.deadLength++)},g.Pool.prototype.empty=function(){this.alive.length=0,this.dead.length=0,this.length=0,this.deadLength=0},g.Pool.prototype.each=function(t,e){var i;if(e)for(i=0;i<this.length;i++)this.alive[i][t](i);else for(i=this.length;i--;)this.alive[i][t](i)},g.roundToNearest=function(t,e){return Math.round(t/e)*e},g.rand=function(t,e){return Math.random()*(e-t)+t},g.randInt=function(t,e){return Math.floor(Math.random()*(e-t+1))+t},g.qS=function(t){var e=document.querySelectorAll(t);return e.length>1?e:e[0]},g.cE=function(t,e){return elem=document.createElement("div"),t&&t.appendChild(elem),e&&g.addClass(elem,e),elem},g.on=function(t,e,i,s){s=s||window,t.addEventListener(e,i.bind(s))},g.text=function(t,e){t.firstChild.nodeValue=e},g.resetAnim=function(t){g.removeClass(t,"anim"),t.offsetWidth=t.offsetWidth,g.addClass(t,"anim")},g.prefixElement=g.cE(),g.prefixMatches={},g.prefixCheck=function(t){if(g.prefixMatches[t])return[g.prefixMatches[t],!0];for(var e=["","Webkit","Moz","ms","O"],i=function(t){return t.toUpperCase()},s=0,o=e.length;o>s;s++){var a;if(a=0===s?t:e[s]+t.replace(/^\w/,i),g.isString(g.prefixElement.style[a]))return g.prefixMatches[t]=a,[a,!0]}return[t,!1]},g.css=function(t,e,i){if(g.isObject(e)){var s=e;for(e in s)s.hasOwnProperty(e)&&g.css(t,e,s[e])}else e=g.prefixCheck(e),e[1]&&(t.style[e[0]]=i)},g.hasClass=function(t,e){return t.classList.contains(e)},g.addClass=function(t,e){-1!=e.indexOf(" ")?(classes=e.split(" "),classes.forEach(function(e){g.addClass(t,e)})):t.classList.add(e)},g.removeClass=function(t,e){-1!=e.indexOf(" ")?(classes=e.split(" "),classes.forEach(function(e){g.removeClass(t,e)})):t.classList.remove(e)},g.toggleClass=function(t,e){t.classList.toggle(e)},g.attr=function(t,e){return t.getAttribute(e)},g.rangeIntersect=function(t,e,i,s){return Math.max(t,e)>Math.min(i,s)&&Math.min(t,e)<Math.max(i,s)},g.rectIntersect=function(t,e){return g.util.rangeIntersect(t.x,t.x+t.width,e.x,e.x+e.width)&&g.util.rangeIntersect(t.y,t.y+t.height,e.y,e.y+e.height)},g.formatPad=function(t,e){return t+="",t.length<e?(t="0"+t,g.util.format.pad(t,e)):t},g.formatTime=function(t){var e=Math.floor(t/60);return t=Math.floor(t%60),g.util.format.pad(e,2)+":"+g.util.format.pad(t,2)},g.formatCommas=function(t){return t=Math.round(t),t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},g.isString=function(t){return"string"==typeof t},g.isObject=function(t){return"object"==typeof t},g.isSet=function(t){return"undefined"!=typeof t},g.isObjEmpty=function(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0},g.merge=function(t,e){for(var i in e)t[i]=e[i]},g.states={},g.addState=function(t,e){g.states[t]=new g.State(e)},g.setState=function(t){g.state&&(g.prevState=g.currentState(),g.states[g.state]._exit()),g.state=t,g.states[g.state]._init()},g.currentState=function(){return g.states[g.state]},g.State=function(t){g.merge(this,t),this.init=g.isSet(this.init)?this.init:function(){},this.step=g.isSet(this.step)?this.step:function(){},this.draw=g.isSet(this.draw)?this.draw:function(){},this.exit=g.isSet(this.exit)?this.exit:function(){}},g.State.prototype._init=function(){this.time=new g.Time,this.init()},g.State.prototype._step=function(){this.step()},g.State.prototype._draw=function(){this.draw()},g.State.prototype._exit=function(){this.exit()},g.Time=function(){this._init()},g.Time.prototype._init=function(){this.now=Date.now(),this.last=Date.now(),this.delta=16,this.ndelta=1,this.elapsed=0,this.nelapsed=0,this.tick=0},g.Time.prototype._step=function(t){t=t||1,this.now=Date.now(),this.delta=this.now-this.last,this.ndelta=Math.min(Math.max(this.delta/(1e3/60),1e-4),10),this.elapsed+=this.delta,this.nelapsed+=this.ndelta,this.gdelta=this.delta*t,this.gndelta=this.ndelta*t,this.gelapsed+=this.gdelta,this.gnelapsed+=this.gndelta,this.last=this.now,this.tick++},Storage.prototype.setObject=function(t,e){this.setItem(t,JSON.stringify(e))},Storage.prototype.getObject=function(t){var e=this.getItem(t);return e&&JSON.parse(e)},Storage.prototype.removeObject=function(t){this.removeItem(t)},g.Storage=function(t){this.namespace=t,this.obj=localStorage.getObject(this.namespace)||{}},g.Storage.prototype.get=function(t){return this.obj[t]},g.Storage.prototype.set=function(t,e){this.obj[t]=e,this.sync()},g.Storage.prototype.sync=function(){localStorage.setObject(this.namespace,this.obj)},g.Storage.reset=function(){this.obj={},this.sync()},g.data.map=[[-1,2],[8,2],[8,3],[10,3],[10,2],[12,2],[12,1],[14,1],[14,2],[18,2],[18,5],[14,5],[14,6],[10,6],[10,5],[7,5],[7,8],[11,8],[11,10],[13,10],[13,8],[17,8],[17,10],[19,10],[19,12],[13,12],[13,13],[8,13],[8,10],[5,10],[5,4],[1,4],[1,6],[3,6],[3,8],[0,8],[0,10],[1,10],[1,12],[6,12],[6,14]],g.data.towers={e:{type:"e",counters:"a",title:"Earth",desc:"Well Rounded",damage:"Medium",bonus:"+50% vs Air",range:"Medium",rate:"Medium",hue:120,stats:[{cost:100,damage:10,range:50,rate:30},{cost:125,damage:12,range:60,rate:28},{cost:175,damage:14,range:70,rate:26}]},w:{type:"w",counters:"f",title:"Water",desc:"Slows Enemies",damage:"Medium",bonus:"+50% vs Fire",range:"Low",rate:"High",hue:200,stats:[{cost:100,damage:10,range:50,rate:30},{cost:125,damage:12,range:60,rate:28},{cost:175,damage:14,range:70,rate:26}]},a:{type:"a",counters:"w",title:"Air",desc:"Pierced Enemies",damage:"Low",bonus:"+50% vs Water",range:"High",rate:"Medium",hue:60,stats:[{cost:100,damage:10,range:50,rate:30},{cost:125,damage:12,range:60,rate:28},{cost:175,damage:14,range:70,rate:26}]},f:{type:"f",counters:"e",title:"Fire",desc:"Splash Damage",damage:"High",bonus:"+50% vs Earth",range:"Low",rate:"Medium",hue:0,stats:[{cost:100,damage:10,range:50,rate:30},{cost:125,damage:12,range:60,rate:28},{cost:175,damage:14,range:70,rate:26}]}},g.data.waves=[[["e",10]],[["e",8],["w",2]],[["e",6],["w",2],["a",2]],[["e",4],["w",2],["a",2],["f",2]],[["e",1,1],["e",3],["w",3],["a",3],["f",3]]],g.Enemy=function(t){g.merge(this,t),this.init()},g.Enemy.prototype.init=function(){this.x=10*g.size,this.y=10*g.size,this.size=20,this.dom=g.cE(this.state.dom.state,"enemy type-"+this.type),g.css(this.dom,{width:this.size+"px",height:this.size+"px"})},g.Enemy.prototype.step=function(){this.state.isPlaying&&(this.x+=1),this.x>g.size*g.cols&&this.destroy()},g.Enemy.prototype.draw=function(){g.css(this.dom,"transform","translate("+this.x+"px , "+this.y+"px )")},g.Enemy.prototype.destroy=function(){this.state.enemies.remove(this),this.state.dom.state.removeChild(this.dom)},g.Tile=function(t){g.merge(this,t),this.init()},g.Tile.prototype.init=function(){this.dom=g.cE(this.state.dom.state,this.classes),g.css(this.dom,{transform:"translate("+this.col*g.size+"px , "+this.row*g.size+"px )",width:g.size+"px",height:g.size+"px","z-index":g.rows-this.row}),g.on(this.dom,"click",this.onClick,this)},g.Tile.prototype.onClick=function(){this.state.isBuildMenuOpen||this.isPath||(this.state.showBuildMenu(this),this.state.lastClickedTile=this)},g.Tower=function(t){g.merge(this,t),this.init()},g.Tower.prototype.init=function(){this.setupDom(),this.setupEvents(),this.slabRotation=this.state.globalSlabRotation,this.turretRotation=this.state.globalTurretRotation,this.coreScale=this.state.globalCoreScale},g.Tower.prototype.step=function(){this.slabRotation+=.2*(this.state.globalSlabRotation-this.slabRotation),this.turretRotation+=.2*(this.state.globalTurretRotation-this.turretRotation),this.coreScale+=.2*(this.state.globalCoreScale-this.coreScale),this.state.isPlaying},g.Tower.prototype.draw=function(){g.css(this.dom.slab,"transform","rotate("+this.slabRotation+"rad)"),g.css(this.dom.turret,"transform","rotate("+this.turretRotation+"rad)"),g.css(this.dom.core,"transform","scale("+this.coreScale+")")},g.Tower.prototype.setupDom=function(){this.dom={},this.dom.wrap=g.cE(this.state.dom.state,"t-wrap t-type-"+this.type),this.dom.tower=g.cE(this.dom.wrap,"t-tower"),this.dom.slab=g.cE(this.dom.tower,"t-slab"),this.dom.turret=g.cE(this.dom.tower,"t-turret"),this.dom.base=g.cE(this.dom.tower,"t-base"),this.dom.core=g.cE(this.dom.tower,"t-core"),this.dom.range=g.cE(this.dom.tower,"t-range"),g.css(this.dom.wrap,"transform","translate3d("+this.col*g.size+"px , "+this.row*g.size+"px, 0 )")},g.Tower.prototype.setupEvents=function(){g.on(this.dom.wrap,"click",this.onClick,this)},g.Tower.prototype.onClick=function(){console.log("click")},g.Wave=function(t){g.merge(this,t),this.init()},g.Wave.prototype.init=function(){this.tick=0,this.tickMax=30,this.enemies=new g.Group,this.counts={e:0,w:0,a:0,f:0}},g.Wave.prototype.step=function(){if(this.tick>=this.tickMax&&this.enemies.length){this.tick=0;var t=this.enemies.shift();this.state.enemies.push(t)}else this.tick++};var StateMenu=function(){};StateMenu.prototype.init=function(){},StateMenu.prototype.step=function(){},StateMenu.prototype.draw=function(){},StateMenu.prototype.exit=function(){},g.addState("menu",new StateMenu);var StatePlay=function(){};StatePlay.prototype.init=function(){this.isPlaying=0,this.isBuildMenuOpen=0,this.isBuildable=0,this.hasPlayed=0,this.speed=1,this.wave=0,this.waveNext=this.wave+1,this.wavesTotal=g.data.waves.length,this.livesTotal=13,this.lives=this.livesTotal,this.fragments=1e4,this.fragmentsDisplay=this.fragments,this.fragmentsDisplayLast=0,this.lastClickedTile=null,this.globalSlabRotation=0,this.globalTurretRotation=0,this.globalCoreScale=.1,this.towers=new g.Group,this.waves=new g.Group,this.activeWaves=new g.Group,this.enemies=new g.Group,this.dom={},this.dom.state=g.qS(".s-play"),this.dom.play=g.qS(".b-play"),this.dom.x1=g.qS(".b-x1"),this.dom.x2=g.qS(".b-x2"),this.dom.x3=g.qS(".b-x3"),this.dom.eAtk=g.qS(".b-e"),this.dom.wAtk=g.qS(".b-w"),this.dom.aAtk=g.qS(".b-a"),this.dom.fAtk=g.qS(".b-f"),this.dom.mute=g.qS(".b-mute"),this.dom.menu=g.qS(".b-menu"),this.dom.send=g.qS(".b-send"),this.dom.lives=g.qS(".d-lives"),this.dom.fragments=g.qS(".d-fragments"),this.dom.wave=g.qS(".d-wave"),this.dom.next=g.qS(".d-next"),this.dom.eWave=g.qS(".w-e"),this.dom.wWave=g.qS(".w-w"),this.dom.aWave=g.qS(".w-a"),this.dom.fWave=g.qS(".w-f"),this.dom.buildMenuWrap=g.qS(".build-menu-wrap"),this.dom.buildMenu=g.qS(".build-menu"),this.dom.buildSelect=g.qS(".build-select"),this.dom.buildDefault=g.qS(".build-d"),this.dom.buildEarth=g.qS(".build-e"),this.dom.buildWater=g.qS(".build-w"),this.dom.buildAir=g.qS(".build-a"),this.dom.buildFire=g.qS(".build-f"),this.dom.buildCost=g.qS(".build-cost"),this.dom.buildType=g.qS(".build-type"),this.dom.buildDesc=g.qS(".build-desc"),this.dom.buildDamage=g.qS(".build-damage"),this.dom.buildRange=g.qS(".build-range"),this.dom.buildRate=g.qS(".build-rate"),g.on(window,"click",this.onWinClick,this),g.on(this.dom.play,"click",this.onPlayClick,this),g.on(this.dom.x1,"click",this.onX1Click,this),g.on(this.dom.x2,"click",this.onX2Click,this),g.on(this.dom.x3,"click",this.onX3Click,this),g.on(this.dom.eAtk,"click",this.onEAtkClick,this),g.on(this.dom.wAtk,"click",this.onWAtkClick,this),g.on(this.dom.aAtk,"click",this.onAAtkClick,this),g.on(this.dom.fAtk,"click",this.onFAtkClick,this),g.on(this.dom.mute,"click",this.onMuteClick,this),g.on(this.dom.menu,"click",this.onMenuClick,this),g.on(this.dom.send,"click",this.onSendClick,this),g.on(this.dom.buildMenuWrap,"click",this.onBuildMenuWrapClick,this),g.on(this.dom.buildMenu,"click",this.onBuildMenuClick,this);for(var t=0,e=this.dom.buildSelect.length;e>t;t++){var i=this.dom.buildSelect[t];g.on(i,"mouseenter",this.onBuildSelectMouseenter,this),g.on(i,"mouseleave",this.onBuildSelectMouseleave,this),g.on(i,"click",this.onBuildSelectClick,this)}this.setupTiles(),this.setupWaves(),this.isPlaying=1,this.step(),this.isPlaying=0},StatePlay.prototype.step=function(){this.updateFragments();for(var t=0;t<this.speed;t++)this.time._step(this.speed),this.updateGlobals(),this.updateWaves(),this.towers.each("step"),this.enemies.each("step")},StatePlay.prototype.draw=function(){this.towers.each("draw"),this.enemies.each("draw")},StatePlay.prototype.exit=function(){},StatePlay.prototype.onWinClick=function(){this.isBuildMenuOpen&&this.hideBuildMenu()},StatePlay.prototype.onPlayClick=function(){this.hasPlayed||(this.advanceWave(),this.hasPlayed=1),this.isPlaying=!this.isPlaying,this.isPlaying?g.addClass(g.dom,"playing"):g.removeClass(g.dom,"playing")},StatePlay.prototype.onX1Click=function(){this.speed=1,g.removeClass(g.dom,"x1 x2 x3"),g.addClass(g.dom,"x1")},StatePlay.prototype.onX2Click=function(){this.speed=2,g.removeClass(g.dom,"x1 x2 x3"),g.addClass(g.dom,"x2")},StatePlay.prototype.onX3Click=function(){this.speed=3,g.removeClass(g.dom,"x1 x2 x3"),g.addClass(g.dom,"x3")},StatePlay.prototype.onEAtkClick=function(){},StatePlay.prototype.onWAtkClick=function(){},StatePlay.prototype.onAAtkClick=function(){},StatePlay.prototype.onFAtkClick=function(){},StatePlay.prototype.onMuteClick=function(){},StatePlay.prototype.onMenuClick=function(){},StatePlay.prototype.onSendClick=function(){this.isPlaying&&this.advanceWave()},StatePlay.prototype.setupTiles=function(){this.baseTiles=new g.Group,this.pathTiles=new g.Group;for(var t=0;t<g.cols;t++)for(var e=0;e<g.rows;e++){var i=this.isPath(t,e),s=["tile"];i&&(s+=" path");var o=new g.Tile({state:this,col:t,row:e,isPath:i||0,classes:s,horizontal:t>g.cols/2?"e":"w",vertical:e>g.rows/2?"s":"n"});i?this.pathTiles.push(o):this.baseTiles.push(o)}},StatePlay.prototype.isPath=function(t,e){for(var i=g.data.map.length,s=0;i-1>s;s++){var o=g.data.map[s],a=g.data.map[s+1],n=Math.min(o[0],a[0]),h=Math.min(o[1],a[1]),r=Math.max(o[0],a[0]),l=Math.max(o[1],a[1]);if(t>=n&&r>=t&&e>=h&&l>=e)return 1}},StatePlay.prototype.updateGlobals=function(){this.globalSlabRotation-=.025,this.globalTurretRotation+=.025,this.globalCoreScale=.3+.15*Math.sin(this.time.tick/30)},StatePlay.prototype.setFragments=function(t){this.fragments+=t},StatePlay.prototype.updateFragments=function(){this.fragmentsDisplay+=.2*(this.fragments-this.fragmentsDisplay),Math.round(this.fragmentsDisplay)!=Math.round(this.fragmentsDisplayLast)&&g.text(this.dom.fragments,g.formatCommas(this.fragmentsDisplay)),this.fragmentsDisplayLast=this.fragmentsDisplay},StatePlay.prototype.setupWaves=function(){for(var t=0,e=g.data.waves.length;e>t;t++){for(var i=g.data.waves[t],s=new g.Wave({state:this}),o=0,a=i.length;a>o;o++)for(var n=i[o],h=n[0],r=n[1],l=n.length>=3?1:0,c=0,d=r;d>c;c++){var u=new g.Enemy({state:this,type:h,isBoss:l});s.enemies.push(u),s.counts[h]++}this.waves.push(s)}},StatePlay.prototype.updateWaves=function(){this.activeWaves.each("step"),this.activeWaves.length||!this.waves.length||this.enemies.length||this.advanceWave(),this.activeWaves.each(function(t,e){t.enemies.length||this.activeWaves.removeAt(e)},0,this)},StatePlay.prototype.advanceWave=function(){if(this.hasPlayed){if(this.waves.length)if(this.activeWaves.push(this.waves.shift()),g.text(this.dom.wave,this.wave+1+" / "+this.wavesTotal),this.wave++,this.wave<this.wavesTotal){this.waveNext++;var t=this.waves.getAt(0);g.text(this.dom.eWave,t.counts.e),g.text(this.dom.wWave,t.counts.w),g.text(this.dom.aWave,t.counts.a),g.text(this.dom.fWave,t.counts.f)}else this.waveNext=null,g.text(this.dom.eWave,"--"),g.text(this.dom.wWave,"--"),g.text(this.dom.aWave,"--"),g.text(this.dom.fWave,"--")}else{var e=this.waves.getAt(0);g.text(this.dom.eWave,e.counts.e),g.text(this.dom.wWave,e.counts.w),g.text(this.dom.aWave,e.counts.a),g.text(this.dom.fWave,e.counts.f),g.text(this.dom.wave,this.wave+" / "+this.wavesTotal)}},StatePlay.prototype.showBuildMenu=function(t){this.isBuildMenuOpen=1,this.isBuildable=1,g.addClass(g.dom,"build-menu-open"),g.removeClass(g.dom,"pos-n pos-e pos-s pos-w"),g.addClass(g.dom,"pos-"+t.horizontal+" pos-"+t.vertical);var e=t.col*g.size-20,i=t.row*g.size-20;"e"==t.horizontal&&(e-=200),g.css(this.dom.buildMenu,"transform","translateX("+e+"px) translateY("+i+"px)"),g.resetAnim(this.dom.buildDefault)},StatePlay.prototype.hideBuildMenu=function(){this.isBuildMenuOpen=0,g.removeClass(g.dom,"build-menu-open")},StatePlay.prototype.updateBuildMenuText=function(t){var e=g.data.towers[t];g.text(this.dom.buildCost,e.stats[0].cost),g.text(this.dom.buildType,e.title),g.text(this.dom.buildDesc,e.desc),g.text(this.dom.buildDamage,e.damage+" "+e.bonus),g.text(this.dom.buildRange,e.range),g.text(this.dom.buildRate,e.rate),g.removeClass(g.dom,"hover-e hover-w hover-a hover-f"),g.addClass(g.dom,"hover-build-select hover-"+t),g.removeClass(g.dom,"dmg1 dmg2 dmg3 rng1 rng2 rng3 rte1 rte2 rte3");var i=1,s=1,o=1;"Medium"==e.damage?i=2:"High"==e.damage&&(i=3),"Medium"==e.range?s=2:"High"==e.range&&(s=3),"Medium"==e.rate?o=2:"High"==e.rate&&(o=3),g.addClass(g.dom,"dmg"+i),g.addClass(g.dom,"rng"+s),g.addClass(g.dom,"rte"+o)},StatePlay.prototype.onBuildMenuWrapClick=function(){this.hideBuildMenu()},StatePlay.prototype.onBuildMenuClick=function(t){t.stopPropagation()},StatePlay.prototype.onBuildSelectMouseenter=function(t){var e=g.attr(t.target,"data-type");e&&this.updateBuildMenuText(e)},StatePlay.prototype.onBuildSelectMouseleave=function(){g.removeClass(g.dom,"hover-build-select")},StatePlay.prototype.onBuildSelectClick=function(t){var e=g.attr(t.target,"data-type");if(e){var i=g.data.towers[e].stats[0].cost;if(i<=this.fragments&&this.isBuildable){this.setFragments(-i);var s=this.lastClickedTile,o=new g.Tower({state:this,col:s.col,row:s.row,type:e});this.towers.push(o),this.isBuildable=0,this.hideBuildMenu()}}},g.addState("play",new StatePlay);var StateGameover=function(){};StateGameover.prototype.init=function(){},StateGameover.prototype.step=function(){},StateGameover.prototype.draw=function(){},StateGameover.prototype.exit=function(){},g.addState("gameover",new StateGameover),g.config={namespace:"elematter",width:800,height:600,size:40,state:"play"},g.init=function(){g.time=new g.Time,g.size=g.config.size,g.width=g.config.width,g.height=g.config.height,g.ratio=g.height/g.width,g.cols=g.width/g.size,g.rows=g.height/g.size,g.scale=1,g.dom=g.qS(".g"),g.css(g.dom,{width:g.width+"px",height:g.height+"px"}),g.storage=new g.Storage(g.config.namespace),g.isObjEmpty(g.storage.obj),g.lastState=null,g.setState(g.config.state),g.step(),g.on(window,"load",g.onLoad),g.on(g.dom,"click",g.onClick),g.on(window,"touchmove",g.onTouchmove),g.on(window,"resize",g.onResize),g.onResize()},g.step=function(){requestAnimationFrame(g.step),g.time._step(),g.states[g.state]._step(),g.states[g.state]._draw()},g.onLoad=function(){g.addClass(g.dom,"loaded")},g.onClick=function(t){t.stopPropagation()},g.onTouchmove=function(t){t.preventDefault()},g.onResize=function(){g.css(g.dom,{marginLeft:-g.width/2+"px",marginTop:-g.height/2+"px"})},g.init();</script>